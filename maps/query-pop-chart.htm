 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <title>Census Population</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>

    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAAyMXauQP0MzldMli2sdt4QRQL_hD2CWbLN6JlXjWuBhaMLOwpsBRGxuqPydeUQMbq_jE2-7RWv_2NVg" type="text/javascript"></script>
    <script src="http://serverapi.arcgisonline.com/jsapi/gmaps/?v=1.4" type="text/javascript" ></script>

    <script type="text/javascript">
    var map = null;
    var parcelQueryTask = null;
    var parcelQuery = null;
    var mapExtension;
    var gOverlays;


    function LoadMap() {

      //Load Google Maps
      map = new GMap2(document.getElementById("mymap"));

      map.addControl(new GLargeMapControl());
      map.addControl(new GMapTypeControl());
      map.setCenter(new GLatLng(41.015,-73.309021), 9);
      map.enableScrollWheelZoom();

      //create mapextension class to be used to add/remove results from the map.
      mapExtension = new esri.arcgis.gmaps.MapExtension(map);

      //create mapOptions to specify opacity, minResolution, maxResolution when adding to the map.
      //var mapOptions = {opacity: 0.75, minResolution:0, maxResolution: 19};

      //create custom tile layer
      //var tiledmap = new esri.arcgis.gmaps.TiledMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Demographics/USA_Tapestry/MapServer", mapOptions, addTiledMap);

      var dynamicMap = new esri.arcgis.gmaps.DynamicMapServiceLayer("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer", null, 0.75, dynmapcallback); 

      function dynmapcallback(mapservicelayer) {
      map.addOverlay(mapservicelayer);
        }

      //Build ArcGIS Server Query Task and Filter against the Parcel Layer
      parcelQueryTask = new esri.arcgis.gmaps.QueryTask("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer/1");

      parcelQuery = new esri.arcgis.gmaps.Query();
      parcelQuery.returnGeometry = true;
      parcelQuery.outFields = ["TRACT","BLKGRP","POP2000","POP2007"];


      GEvent.addListener(map, "click", function(marker, point) {
        if(!marker){
          mapExtension.removeFromMap(gOverlays);
          gOverlays=null;
          parcelQuery.queryGeometry = point;
          parcelQueryTask.execute(parcelQuery, false, mycallback);
        }
      });
    }

    /* function addTiledMap(gTileLayer) {
      //Add tile layer as a GTileLayerOverlay using mapExtension
      mapExtension.addToMap(gTileLayer);
    } */

    

    function mycallback(fset) {
      var fe = fset.features;
      for (var x = 0; x < fe.length; x++) {
        var feature = fe[x];
        var att = feature.attributes;
          var POP2000p = parseInt(att.POP2000);
          var POP2007p = parseInt(att.POP2007);

		
		  
	  //JS literal class esri.arcgis.gmaps.InfoWindowOptions with tabs
	  var infoWindowOptionsTabs = {
            contentTabs:[{label:"Tract Info", content:"<b>TRACT: </b>{TRACT}<br/><b>BlockGroup: </b>{BLKGRP}<br/>"},
			             {label:"Population", content:"<div style='width:200px; height:175px;'><b>Population:</b> 2000 and 2007<br />"
                    + "<img height=140 width=180 src='http://chart.apis.google.com/chart?cht=bvs&amp;chs=180x140&amp;chd=t:" + POP2000p + "," + POP2007p + "&amp;chds=a&amp;chxt=y&amp;chxr=a&amp;chl=2000|2007&amp;chm=N*,000000,0,-1,10' /></div>"}],
          };

          mapExtension.addToMap(feature, null, infoWindowOptionsTabs);
        }// end for loop
      }

  
  </script>

  </head>
  <body onload="LoadMap()"  onunload="GUnload()">

    
<div id="mymap" style="position:relative; width:800px; height:600px;"></div>
    Click to select a Census Tract, then click again to get more information.&nbsp; <a href="javascript:map.clearOverlays();">Clear Selection</a>


  </body>
</html>
